# 📱 Update Fitur Baru - WhatsApp Notification

## 🎉 Fitur Baru yang Ditambahkan:

### 1. ✏️ **Edit Data Siswa dengan Nomor WhatsApp**

#### Apa yang Baru:

-   Tambah kolom **WhatsApp** di tabel siswa
-   Kolom **Notifikasi** (Aktif/Non-aktif)
-   Tombol **Edit** untuk setiap siswa
-   Modal edit lengkap dengan semua field

#### Cara Pakai:

**Opsi 1: Saat Tambah Siswa Baru**

1. Klik tombol "Tambah Siswa"
2. Isi:
    - Nomor Absen
    - Nama Lengkap
    - **Nomor WhatsApp** (opsional)
    - ✓ Centang "Aktifkan notifikasi WhatsApp"
3. Klik Simpan

**Opsi 2: Edit Siswa yang Sudah Ada**

1. Masuk ke tab **"Siswa"**
2. Klik tombol **"Edit"** di samping nama siswa
3. Update data:
    - Nama
    - Nomor Absen
    - **Nomor WhatsApp**
    - Status (Aktif/Tidak Aktif/Alumni)
    - Toggle **Notifikasi**
4. Klik "Update"

#### Format Nomor WhatsApp:

✅ **Valid:**

-   `08123456789`
-   `628123456789`

❌ **Tidak Valid:**

-   `+628123456789` (jangan pakai +)
-   `0812-3456-789` (jangan pakai strip)
-   `0812 3456 789` (jangan pakai spasi)

#### Screenshot Tabel Siswa:

```
Absen | Nama | WhatsApp | Status | Notifikasi | Aksi
------|------|----------|--------|------------|------
1     | Budi | 📱 08123  | Aktif  | ✓ Aktif    | Edit | 🗑️
2     | Ani  | Belum    | Aktif  | ✗ Non-aktif| Edit | 🗑️
```

---

### 2. 📱 **Kirim Reminder ke Grup WhatsApp**

#### Apa itu Fitur Ini?

Alih-alih kirim pesan individual satu per satu, sekarang Anda bisa kirim **1 pesan ke grup kelas** yang otomatis **mention (@)** semua siswa yang belum bayar!

#### Keunggulan:

✅ **Hemat Kuota API** - 1 pesan untuk semua orang
✅ **Efisien** - Tidak perlu kirim berulang kali
✅ **Transparent** - Semua siswa tahu siapa yang belum bayar
✅ **Auto-Mention** - Sistem otomatis mention setiap nomor

#### Format Pesan Grup:

**Contoh dengan Style Friendly:**

```
📢 *REMINDER KAS KELAS* 📢

Halo semuanya! 👋

Ini pengingat ramah untuk teman-teman
yang belum bayar kas kelas ya~ 😊

*3 Minggu (Rp 6.000)*
• @628123456789 (Budi)
• @628987654321 (Ani)

*2 Minggu (Rp 4.000)*
• @628111222333 (Citra)

Yuk segera dilunasi ya! 🥰
Ditunggu pembayarannya~ 💙

_Pesan otomatis dari sistem kas kelas_
```

**Contoh dengan Style Humorous:**

```
🔔 *BREAKING NEWS!* 🔔

Wartawan kami melaporkan ada
beberapa VIP yang belum bayar kas! 😂

*3 Minggu (Rp 6.000)*
• @628123456789 (Budi)
• @628987654321 (Ani)

*2 Minggu (Rp 4.000)*
• @628111222333 (Citra)

Yang disebutkan, buruan bayar
biar turun dari trending topic! 😆

_Auto-generated by Kas Bot 🤖_
```

#### Cara Pakai:

##### Step 1: Dapatkan Group ID WhatsApp

**Metode 1: Via Fonnte Dashboard**

1. Login ke https://fonnte.com
2. Klik menu **"Devices"**
3. Pilih device yang sudah connect
4. Lihat daftar **"Groups"**
5. Copy **Group ID** (format: 628xxx-xxx@g.us)

**Metode 2: Via API Call**

```bash
curl -X POST https://api.fonnte.com/get-devices \
  -H "Authorization: YOUR_FONNTE_TOKEN"
```

Response akan berisi list grup dengan format:

```json
{
    "groups": [
        {
            "id": "628123456789-1234567890@g.us",
            "name": "Kelas 12-A IPA"
        }
    ]
}
```

##### Step 2: Kirim ke Grup

1. Buka aplikasi → Tab **"Notifikasi"**
2. Klik tab **"Kirim ke Grup"** 📱
3. Isi:
    - **Group ID:** `628xxx-xxx@g.us`
    - **Minimum Minggu Telat:** 1, 2, 3, atau 4
    - **Style Pesan:** Pilih style (Friendly/Humor/etc)
4. Klik **"Preview Pesan"** untuk lihat hasil
5. Jika sudah OK, klik **"Kirim ke Grup"**

##### Step 3: Verifikasi di Grup

Buka grup WhatsApp dan cek:

-   ✅ Pesan masuk ke grup
-   ✅ Semua nomor ter-mention (muncul @nama)
-   ✅ Siswa yang di-mention dapat notifikasi

---

## 🔧 Technical Details

### Backend Changes:

**1. Model Student Updated:**

```javascript
// server/models/Student.js
{
  name: String,
  absen: Number,
  status: String,
  phoneNumber: String,        // NEW!
  enableNotification: Boolean, // NEW!
  lastNotificationSent: Date,  // NEW!
}
```

**2. New WhatsApp Service Method:**

```javascript
// server/services/whatsappService.js
-generateGroupReminderMessage() - // Generate pesan dengan mention
    sendToGroup(); // Kirim ke grup WA
```

**3. New API Endpoints:**

```javascript
POST / api / notifications / send - to - group;
POST / api / notifications / preview - group;
```

### Frontend Changes:

**1. Updated Components:**

-   `App.jsx` - Tambah modal Edit Student
-   `NotificationManager.jsx` - Tambah tab "Kirim ke Grup"

**2. New Features:**

-   Edit student form dengan field WhatsApp
-   Toggle notifikasi per siswa
-   Preview pesan grup
-   Kirim ke grup WhatsApp

---

## 📊 Perbandingan: Individual vs Grup

| Aspek            | Kirim Individual      | Kirim ke Grup          |
| ---------------- | --------------------- | ---------------------- |
| **Jumlah Pesan** | 1 per siswa           | 1 untuk semua          |
| **API Calls**    | Banyak                | 1 saja                 |
| **Biaya**        | Tinggi jika banyak    | Lebih murah            |
| **Privasi**      | Private               | Public (semua lihat)   |
| **Efektivitas**  | Bagus untuk follow-up | Bagus untuk pengumuman |
| **Mention**      | Tidak ada             | Ada @mention           |

---

## 💡 Tips Penggunaan:

### Kapan Pakai Kirim Individual?

-   Follow-up siswa yang sangat telat (≥4 minggu)
-   Reminder pribadi yang lebih sopan
-   Siswa yang minta jangan di-mention public

### Kapan Pakai Kirim Grup?

-   Pengumuman reminder rutin
-   Awal minggu/akhir minggu
-   Saat ingin "peer pressure" positif
-   Hemat kuota API Fonnte

### Kombinasi Strategi:

1. **Senin pagi** - Kirim ke grup (reminder umum)
2. **Rabu siang** - Individual ke yang ≥3 minggu
3. **Jumat sore** - Grup lagi dengan style berbeda
4. **Weekend** - Individual ke yang super telat

---

## 🔒 Privacy & Etika:

### Hal yang Perlu Diperhatikan:

1. **Izin Grup**

    - Pastikan grup setuju untuk reminder otomatis
    - Jangan spam terlalu sering

2. **Frekuensi**

    - Maksimal 2-3x per minggu untuk grup
    - Jangan kirim di malam hari

3. **Tone Pesan**

    - Gunakan style "Friendly" atau "Gentle" untuk grup
    - Hindari "Formal" yang terlalu kaku
    - "Humorous" OK kalau suasana kelas fun

4. **Privasi**
    - Beberapa siswa mungkin sensitif di-mention public
    - Sediakan opsi untuk disable notifikasi
    - Offer kirim individual jika minta

---

## 🐛 Troubleshooting:

### Problem: Pesan tidak masuk ke grup

**Solusi:**

1. Cek Group ID valid (format: 628xxx-xxx@g.us)
2. Pastikan bot sudah join grup
3. Cek di Fonnte dashboard apakah grup terdaftar
4. Test dengan API Fonnte langsung

### Problem: Mention tidak berfungsi

**Solusi:**

-   Format nomor harus `@628xxx` (bukan `@08xxx`)
-   Nomor WA siswa harus valid dan terdaftar di WA
-   Siswa harus ada di grup tersebut

### Problem: Siswa tidak dapat notifikasi mention

**Kemungkinan:**

-   Nomor tidak terdaftar di WA
-   Nomor bukan anggota grup
-   Setting WA siswa block mention

---

## 📈 Monitoring & Analytics:

### Check Effectiveness:

1. **Via Riwayat Tab:**

    - Cek status: sent/failed
    - Lihat timestamp pengiriman
    - Monitor response rate

2. **Via Stats:**

    - Total sent (individual + group)
    - Success rate
    - Last 7 days activity

3. **Manual Check:**
    - Lihat read receipt di grup
    - Track siapa yang bayar setelah reminder
    - Feedback dari siswa

---

## 🚀 Next Steps:

Setelah setup, Anda bisa:

1. ✅ Update nomor WA semua siswa
2. ✅ Test kirim ke grup (mode test dulu!)
3. ✅ Set schedule reminder grup
4. ✅ Monitor effectiveness
5. ✅ Adjust strategy based on feedback

---

## 📞 Support:

Jika ada pertanyaan atau issue:

1. Cek `WHATSAPP_BOT_GUIDE.md` untuk setup dasar
2. Test dengan `WA_TEST_MODE=true` dulu
3. Check Fonnte dashboard untuk troubleshooting
4. Monitor server console log untuk error

---

**Happy Reminding! 🎉**

Dengan 2 fitur baru ini, manajemen kas kelas jadi lebih mudah dan efisien!
